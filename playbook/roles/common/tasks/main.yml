---
# Installing common things

- name: Add PPAs
  apt_repository:
    repo={{item}}
    state=present
    update_cache=yes
  with_items:
    - ppa:git-core/ppa
    - ppa:pi-rho/dev
  become: yes

- name: Install packages
  apt:
    name={{item}}
    state=latest
  with_items:
    - vim
    - zsh
    - tmux
    - htop
    - git
    - unrar
    - cmake
    - build-essential
    - python-dev
    - xclip
    - ranger
  become: yes

- name: Installing vundle
  git:
    repo=https://github.com/gmarik/Vundle.vim.git
    dest=~/.vim/bundle/Vundle.vim

- name: Installing YouCompleteMe
  git:
    repo=https://github.com/Valloric/YouCompleteMe.git
    dest=~/.vim/bundle/YouCompleteMe
    update=yes
  register: ycm_git

- name: Compile YouCompleteMe
  command: ./install.sh --clang-completer
  args:
    chdir: /home/{{remote_user}}/.vim/bundle/YouCompleteMe
  when: ycm_git.changed

- name: Install vim plugins
  command: vim +PluginInstall +qall

- name: Ensure projects directory exists
  file:
    path=/home/{{remote_user}}/Projects/fonts
    state=directory

- name: Add powerline fonts
  git:
    repo=https://github.com/powerline/fonts.git
    dest=/home/{{user}}/Projects/fonts/powerline-fonts
  register: fonts_git

- name: Install powerline fonts
  command: ./install.sh
  args:
    chdir: /home/{{user}}/Projects/fonts/powerline-fonts
  when: fonts_git.changed

- name: Install tmux plugin manager
  git:
    repo=https://github.com/tmux-plugins/tpm
    dest=~/.tmux/plugins/tpm

- name: Install tmux plugins
  command: ./install_plugins all
  args:
    chdir: /home/{{username}}/.tmux/plugins/tpm/bin

- name: Update tmux plugins
  command: ./update_plugins all
  args:
    chdir: /home/{{username}}/.tmux/plugins/tpm/bin

- name: Install oh-my-zsh
  git:
    repo=https://github.com/robbyrussell/oh-my-zsh.git
    dest=~/.oh-my-zsh

- name: Ensure shell is zsh
  user:
    name={{username}}
    shell=/usr/bin/zsh
  become: yes

